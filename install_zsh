#!/bin/bash

if [ -n "$1" ];then
	ssh -t $1 bash <<END
if [ -d "./interim_installer" ]; then
	git-force-clone  https://github.com/Yougain/interim_installer.git ~/interim_installer
else
	git clone https://github.com/Yougain/interim_installer.git
fi
./interim_installer/${0##*/}
END
	exit $?
fi

if [ -z "`which zsh`" ];then
	echo "zsh installed. exit."
	exit 1
fi


if [ -n "`which dnf`" ];then
	CMD="dnf"
	DEV="devel"
else
	if [ -n "`which yum`" ];then
		CMD="yum"
		DEV="devel"
	else
		if [ -n "`which apt-get`" ];then
	        CMD="apt-get"
			DEV="dev"
		else
			echo "Error: package installer not found."
		fi
	fi
fi
if [ -n "`which git`" ];then
	sudo $CMD -y install git
ifi

sudo $CMD -y install ruby zsh make gcc ruby-$DEV git git-extras
sudo gem install YkLib binding_of_caller
git-force-clone  https://github.com/Yougain/interim_installer.git ~/interim_installer


sudo cp $HOME/interim_installer/lsr /usr/bin
sudo cp $HOME/interim_installer/zsh_rb /usr/bin
sudo cp $HOME/interim_installer/addline /usr/bin

sudo cp $HOME/interim_installer/zshrc.local /etc

function setup_home(){
	while (( "$#" )); do
		sudo cp $HOME/interim_installer/.vimrc $1
		sudo cp -r $HOME/interim_installer/.vim $1
		sudo cp $HOME/interim_installer/.zshrc $1
		shift
	done;
}

setup_home /etc/skel /root /home/*
sudo sed -i 's/bash/zsh/' /etc/passwd

